<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebShell - Execute Commands Easily</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
    <script>
    $(document).ready(function () {
        function executeCommand(command) {
            if (!command) return;
            $.ajax({
                type: "POST",
                url: "/execute",
                contentType: "application/json",
                data: JSON.stringify({ command: command }),
                success: function (response) {
                    $("#output").html(response);
                    initializeDataTable();
                },
                error: function () {
                    $("#output").html("<p class='text-danger'>Error executing command</p>");
                }
            });
        }

        function initializeDataTable() {
            setTimeout(() => {
                if ($.fn.DataTable.isDataTable("#commandTable")) {
                    $("#commandTable").DataTable().destroy();
                }
                $("#commandTable").DataTable({
                    "paging": true,
                    "searching": true,
                    "ordering": true,
                    "info": true
                });
            }, 500);
        }

        function updateBrowserTime() {
            setInterval(() => {
                let now = new Date().toLocaleTimeString();
                $("#browserTime").text(`Browser Time: ${now}`);
            }, 1000);
        }

       function updateServerUptime() {
    $.ajax({
        type: "GET",
        url: "/server-uptime",
        success: function (response) {
            let serverStartTime = response.serverStartTime; // Get server start time in milliseconds

            function refreshServerTime() {
                let currentTimeMillis = serverStartTime + (Date.now() - serverStartTime);
                let serverTime = new Date(currentTimeMillis).toLocaleTimeString();
                $("#serverUptime").text(`Server Time: ${serverTime}`);
            }

            refreshServerTime();
            setInterval(refreshServerTime, 1000);
        }
    });
}

        $("#predefinedCommands").change(function () {
            executeCommand($(this).val());
        });

        $("#commandForm").submit(function (event) {
            event.preventDefault();
            executeCommand($("#commandInput").val().trim());
        });

        $("#commandInput").keydown(function (event) {
            if (event.key === "Enter") {
                event.preventDefault();
                executeCommand($("#commandInput").val().trim());
            }
        });

        updateBrowserTime();
        updateServerUptime();
    });
    </script>
</head>
<body>
<header class="bg-dark text-white py-2 px-3 d-flex justify-content-between align-items-center">
    <h5 class="mb-0">WebShell - <strong>Execute Commands Easily</strong> | <small>Your terminal, now in a web browser!</small></h5>
    <div>
        <span id="browserTime">Local Time: Loading...</span> |
        <span id="serverUptime">Server Time: Fetching...</span>
    </div>
</header>
<div class="container-fluid mt-3">
    <div class="row">
        <div class="col-3 bg-light p-3" id="sidebar">
            <h6>Predefined Commands</h6>
            <select id="predefinedCommands" class="form-select mb-3">
                <option value="">Select a command</option>
                <option value="ls -ltr">List Files</option>
                <option value="df -h">Disk Usage</option>
                <option value="ps -eaf">Running Processes</option>
            </select>
            <h6>Custom Command</h6>
            <form id="commandForm">
                <input type="text" id="commandInput" class="form-control" placeholder="Enter command">
                <button class="btn btn-primary mt-2" type="submit">Run</button>
            </form>
        </div>
        <div class="col-9 p-3">
            <h5>Command Output</h5>
            <div id="output"></div>
        </div>
    </div>
</div>
</body>
</html>
